---
title: "Regression Model Project"
author: "Ziwen Yu"
output: pdf_document
---

## Executive Summary
This report is to build a regression model to test the relationship between car mpg (mile per gallon) and transimisison type. The exploratory analysis and test of mpg distribution difference by transmission type is provided first. Linear regression model is then built between mpg and transimission type. Further anlaysis is performed to exam if other variables should be included in the model to get a good fit of the observation. Plots are all placed in the appendix.

```{r Environment,message=FALSE,message=FALSE}
libs=c('ggplot2','scales')
lapply(libs,library, character.only=T)
# Plot style
Plot_theme = theme_bw()+
      theme(plot.title = element_text(size = 12)
            ,axis.title.x = element_text(size=10)
            ,axis.title.y = element_text(size=10)
            ,axis.text.x = element_text(size=8,angle = 45, hjust = 1)
            ,axis.text.y = element_text(size=8)            
      )
# Load Data
data(mtcars)
mtcars$cyl <- as.factor(mtcars$cyl)
mtcars$vs <- as.factor(mtcars$vs)
mtcars$am <- factor(mtcars$am)
mtcars$gear <- factor(mtcars$gear)
mtcars$carb <- factor(mtcars$carb)
```

## Exploratory Analysis and Comparison of MPG distribution Means
The mpg distributions of different transmission types are shown in **Figure 1** in appendix. Given limited sample size, t test is used to compare the means of mpg distributions by transmission types. Null hypothesis for this test (in the following code chunk) is that mean MPGs of automatic and manual transmissions are equal.
```{r T test for mean MPGs}
MPGmuTest=with(mtcars,t.test(mpg~am))
MPGmuTest$p.value   #P value of test
MPGmuTest$estimate  #MPG means of different transmission type
```
The P value of the test is `r round(MPGmuTest$p.value,4)` which indicates a statistically significant difference between MPG means of automatic and manual transmissions. Cars with automatic transmission have a mean MPG of `r round(MPGmuTest$estimate[1],2)` which is lower than manual transmission cars' mean MPG of `r round(MPGmuTest$estimate[2],2)`.


## Regression models
### all variables
null hypothesis: all coeffificent equal 0.
```{r full model}
fullmodel=lm(mpg~.,data=mtcars)
with(summary(fullmodel),pf(fstatistic[1], fstatistic[2], fstatistic[3], lower.tail=F)) #Get P value from F distribution value
```
P value is  `r with(summary(fullmodel),pf(fstatistic[1], fstatistic[2], fstatistic[3], lower.tail=F))`, much less than alpha=0.5. null hypothesis is rejected. 

### selected variables
```{r AIC selection}
sltVarmodel=step(fullmodel)
```
Only cyl, hp, wt and am variable are picked based on AIC value.

### correlated variables
```{r pair plot for selected variable}
pairs(mtcars[,c('cyl','hp','wt','am')],panel=panel.smooth,main='Pair Graph of Selected Model Variables')
```
may have interaction between wt and hp. Add interactive variable wt*hp into model
```{r interaction variable model}
intactmodel=lm(mpg~cyl + hp + wt + am+wt*hp,data=mtcars)
```

### easiest model
null hypothesis: the coefficient of interactive variable wt*qsec equals 0
```{r anova to estimate the interactive variable}
anova(sltVarmodel,intactmodel)
```
P value is 0.035 which is significant to reject the null hypothesis on 5% level . The interactive variable should be inclued in the regression model.

### residual analysis
```{r residual plot}
par(mfrow = c(2, 2))
plot(intactmodel)
```

## Conclusion

## Appendix  
#### Figure 1: mpg distribution by transmission type
```{r MPG Distribution by Transimission}
ggplot(data=mtcars)+
  geom_boxplot(aes(factor(am),mpg))+
  labs(x='Transmission (0: Automatic, 1: Manual)')+
  Plot_theme
```
