---
output: pdf_document
---

## Exponential Distribution Simulation and Demonstrate Central Limit Theorem

##### Author: Ziwen Yu  
##### Date: 2015-02-09  

-------------

This report, generated in **knitr**, contains the simulation on exponential distribution and demonstratation of the "Central Limit Theorem". The analysis is  performed in **R** and uses **ggplot2** for plotting.
The rate of exponential distribution which the random numbers are generated from is **0.2**.  

**Steps of this analysis:**  

1. Generate 1000 sets of 40 exponentially distributed random numbers using rexp() and calculate the mean of each set

2. Estimate the mean and variance of the sample means with the theoretical mean and variance

3. Test the normality of the distribution of sample means   


####Step 1:
```{r}
set.seed(10)      # set seed for generating random numbers
rate=0.2          # Rate of exponential distribution
n=40              # Number of samples for each sample set

# Generate 40 exponentially distributed random numbers for a sample set
# Calculate the mean of each sample set
# Replicate this process 1000 times
Dt=data.frame(Means=replicate(1000,mean(rexp(n,rate))))

summary(Dt$Means)
```

####Step 2:  
It could be seen from the following code that the sample mean (**5.04506**) is very close to the theoretical mean of the population (**5**). 
```{r}

1/rate            # Theoretical mean
mean(Dt$Means)    # Sample mean

```
The sample variance (**25.49018**) is also very close to the theoretical variance which is **25**.
```{r}

(1/rate)^2        # Theoretical variance
sd(Dt$Means)^2*n  # Sample variance
```

####Step 3:  
From the plot, the big portion of the distribution of sample means is centered around 5 and symmetric to it. However, the tail part is right skewed.
```{r}
# Load plotting package and define plot theme
library(ggplot2)
Plot_theme = theme_bw()+
      theme(plot.title = element_text(size = 24)
            ,axis.title.x = element_text(size=18)
            ,axis.title.y = element_text(size=18)
            ,axis.text.x = element_text(size=16)
            ,axis.text.y = element_text(size=16)            
      )

# Plot the distribution of sample means
ggplot(data=Dt)+
      geom_histogram(aes(Means),fill='grey',binwidth=0.1)+
      Plot_theme+
      labs(title="Hitogram of Sample Means")
```


A Quantile-Quantile (QQ) plot is then employed to further test its normality. As the following figure shows, the distribution of sample means overlaps with the normality line around its mean. The tails do not match normality very well due to the small size of the sample set. It could be infered that this match would be improved with the increase of the sample set size (**n**).

```{r}
 
# Code copied from qqline() in R to plot the normality line in QQ plot using ggplot2
gg_qqline<-function(y,probs = c(0.25,0.75)) {
      distribution=qnorm
      stopifnot(length(probs) == 2, is.function(distribution))
      y <- quantile(y, probs, names = FALSE, type = 7, na.rm = TRUE)
      x <- distribution(probs)
      slope <- diff(y)/diff(x)
      int <- y[1L] - slope * x[1L]
      geom_abline(slope=slope,intercept =int, linetype="dashed",col='red',size=1)
}

# QQ plot using ggplot2
ggplot(data=Dt,aes(sample=Means))+
      stat_qq()+
      gg_qqline(Dt)+
      Plot_theme+
      labs(title='Normal Probability Plot (n=40)'
           ,x='Theoretical Normal Distribution'
           ,y='Sample Mean Distribution')
```

The following plot demonstrate the inference by increasing the sample set size from 40 to 100. The QQ plot matches the normality line much better than the previous one.
```{r}
set.seed(10)      # set seed for generating random numbers
rate=0.2          # Rate of exponential distribution
n=100 

# Generate 40 exponentially distributed random numbers for a sample set
# Calculate the mean of each sample set
# Replicate this process 1000 times
Dt=data.frame(Means=replicate(1000,mean(rexp(n,rate))))

# QQ plot using ggplot2
ggplot(data=Dt,aes(sample=Means))+
      stat_qq()+
      gg_qqline(Dt)+
      Plot_theme+
      labs(title='Normal Probability Plot (n=100)'
           ,x='Theoretical Normal Distribution'
           ,y='Sample Mean Distribution')
```


